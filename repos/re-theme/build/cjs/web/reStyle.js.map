{"version":3,"file":"reStyle.js","sources":["../../../src/reStyle/reStyleHooks.js","../../../src/reStyle/reStyle.js"],"sourcesContent":["import { useMemo, useRef } from 'react'\nimport { useTheme } from '../hooks/useTheme'\nimport {\n  ensureArr,\n  uuid,\n  isObj,\n  deepMerge,\n  noOpObj,\n  isFunc,\n  shallowEqual,\n} from '@keg-hub/jsutils'\n\n/**\n * Helper to get the name of a component, or an ID for reference\n * @function\n * @param {React.Component} Component - Component to get the name from\n *\n * @returns {string} - Name of the Component or generated id when name does not exist\n */\nexport const getComponentName = Component => {\n  return (\n    Component.displayName ||\n    Component.name ||\n    `keg-${uuid().split('-')\n      .slice(4)\n      .join('')}`\n  )\n}\n\n/**\n * Hook to ensure the className prop is an array with the compName argument added to it\n * @function\n * @param {String|Array} className - Current class names already set\n * @param {string} compName - Name of a component to be added as a class name\n *\n * @returns {Array} - Built array of class names with the compName name added to it\n */\nexport const usePropClassName = (className, compName) => {\n  return useMemo(() => {\n    const classArr = className ? ensureArr(className) : []\n    compName && classArr.push(compName)\n\n    return classArr\n  }, [ className, compName ])\n}\n\n/**\n * Hook that memoizes the merged objects using a shallow-equal comparison\n * @function\n * @param {Object} reStyles - Styles generated form useReStyles hook\n * @param {Object} styleFromProps - Styles passed in from props\n *\n * @returns {Object} - merged object\n */\nexport const useShallowMemoMerge = (reStyles, styleFromProps) => {\n  const identity = useRef(null)\n\n  return useMemo(() => {\n    if (!styleFromProps || styleFromProps === noOpObj) return reStyles\n    if (!reStyles || reStyles === noOpObj) return styleFromProps\n\n    const merged = deepMerge(reStyles, ...ensureArr(styleFromProps))\n\n    const foundIdentity = shallowEqual(identity.current, merged)\n      ? identity.current\n      : merged\n\n    // if the merged object is shallowly different than the cached identity,\n    // update the identity\n    if (foundIdentity !== identity.current) {\n      identity.current = foundIdentity\n    }\n\n    return foundIdentity\n  }, [ reStyles, styleFromProps ])\n}\n\n/**\n * Hook to memoize the styles and return them\n * <br/> Calls styleData when its a function passing in the theme and props\n * @function\n * @param {Object|function} styleData - Custom styles or function return custom styles\n * @param {Object} props - Props of the component being wrapped\n *\n * @returns {Object} - Build styles object\n */\nexport const useReStyles = (styleData, props) => {\n  const theme = useTheme()\n  const lastProps = useRef(props)\n\n  useMemo(() => {\n    !shallowEqual(props, lastProps.current) && (lastProps.current = props)\n  }, [ props, lastProps ])\n\n  return useMemo(() => {\n    return isFunc(styleData)\n      ? styleData(theme, lastProps.current)\n      : isObj(styleData)\n        ? styleData\n        : noOpObj\n  }, [ theme, styleData, lastProps.current ])\n}\n\n/**\n * Merges props\n * @param {Object} props - component props\n * @param {*} defaultProps - optional default props defined at reStyle site\n * @returns {Object} - merged props and defaultProps\n */\nexport const useMergedProps = (props, defaultProps) => {\n  // defaultProps will never change, so we can safely short circuit\n  // if it's undefined\n  if (!defaultProps) return props\n\n  const theme = useTheme()\n\n  const finalDefProps = useMemo(\n    () => (isFunc(defaultProps) ? defaultProps(theme) : defaultProps),\n    [ theme, props, defaultProps ]\n  )\n\n  return useMemo(() => ({ ...finalDefProps, ...props }), [ finalDefProps, props ])\n}\n","import React from 'react'\nimport { StyleInjector } from 'StyleInjector'\nimport { exists, noOpObj, isObj } from '@keg-hub/jsutils'\n\nimport {\n  useReStyles,\n  useMergedProps,\n  getComponentName,\n  usePropClassName,\n  useShallowMemoMerge,\n} from './reStyleHooks'\n\nlet __RE_STYLE_CONFIG__ = noOpObj\n\n/**\n * Builds a HOC, with custom styles injected into it\n * @function\n * @param {React.Component} Component - Component to wrap with custom styles\n * @param {string} [styleProp='style'] - Alternate props key to use other then 'style'\n * @param {Object} [config] - Custom config, overrides the global reStyle config\n *\n * @returns {React.Component} HOC that will inject the custom styles\n */\nexport const reStyle = (Component, styleProp = 'style', config = noOpObj) => {\n  const compName = getComponentName(Component)\n  const InjectedComp = StyleInjector(Component, {\n    className: compName,\n    ...__RE_STYLE_CONFIG__,\n    displayName: compName,\n    ...config,\n  })\n\n  /**\n   * @param {Object | Function} styleData - theme or theme function (theme, props) => styles\n   * @param {Object | Function} defaultProps - default props or function that returns default props (theme) => defaultProps\n   */\n  return (styleData, defaultProps) => {\n    const StyledFun = React.forwardRef((props, ref) => {\n      const reStyles = useReStyles(styleData, props)\n      const classArr = usePropClassName(props.className, compName)\n      const styleFromProps = exists(props[styleProp]) ? props[styleProp] : null\n\n      const styles = useShallowMemoMerge(reStyles, styleFromProps)\n      const mergedProps = useMergedProps(props, defaultProps)\n\n      return (\n        <InjectedComp\n          {...mergedProps}\n          {...{ [styleProp]: styles }}\n          ref={ref}\n          className={classArr}\n          __reStyleStylePropKey__={styleProp}\n        />\n      )\n    })\n\n    StyledFun.displayName = `reStyle(${compName})`\n\n    return StyledFun\n  }\n}\n\n/**\n * Helper to set the global config object for reStyle\n * @param {Object} config - Config settings for global reStyle\n * @param {string} config.className - Default className applied to components\n * @param {string} [config.prefix=keg] - Class prefix to prefix to hashed classNames\n * @param {Array} [config.filter] - Group of style rules that should be **ignored** by reStyle\n * @param {string} [config.maxSelectors=1] - Number of selectors used when applying styles\n * @param {Array} [config.important] - Group of style rules that should have `!important` appended to them\n */\nreStyle.setConfig = config => {\n  if (!isObj(config))\n    console.warn(`Restyle config must be an \"Object\". Instead got`, config)\n  __RE_STYLE_CONFIG__ = config\n}\n"],"names":["getComponentName","Component","displayName","name","uuid","split","slice","join","usePropClassName","className","compName","useMemo","classArr","ensureArr","push","useShallowMemoMerge","reStyles","styleFromProps","identity","useRef","noOpObj","merged","deepMerge","foundIdentity","shallowEqual","current","useReStyles","styleData","props","theme","useTheme","lastProps","isFunc","isObj","useMergedProps","defaultProps","finalDefProps","__RE_STYLE_CONFIG__","reStyle","styleProp","config","InjectedComp","StyleInjector","StyledFun","React","forwardRef","ref","exists","styles","mergedProps","__reStyleStylePropKey__","setConfig","console","warn"],"mappings":"2kBAmBaA,iBAAmB,SAAAC,UAE5BA,EAAUC,aACVD,EAAUE,oBACHC,SAAOC,MAAM,KACjBC,MAAM,GACNC,KAAK,MAYCC,iBAAmB,SAACC,EAAWC,UACnCC,WAAQ,eACPC,EAAWH,EAAYI,YAAUJ,GAAa,UACpDC,GAAYE,EAASE,KAAKJ,GAEnBE,IACN,CAAEH,EAAWC,KAWLK,oBAAsB,SAACC,EAAUC,OACtCC,EAAWC,SAAO,aAEjBR,WAAQ,eACRM,GAAkBA,IAAmBG,UAAS,OAAOJ,MACrDA,GAAYA,IAAaI,UAAS,OAAOH,MAExCI,EAASC,0BAAUN,+BAAaH,YAAUI,MAE1CM,EAAgBC,eAAaN,EAASO,QAASJ,GACjDH,EAASO,QACTJ,SAIAE,IAAkBL,EAASO,UAC7BP,EAASO,QAAUF,GAGdA,IACN,CAAEP,EAAUC,KAYJS,YAAc,SAACC,EAAWC,OAC/BC,EAAQC,aACRC,EAAYZ,SAAOS,UAEzBjB,WAAQ,YACLa,eAAaI,EAAOG,EAAUN,WAAaM,EAAUN,QAAUG,KAC/D,CAAEA,EAAOG,IAELpB,WAAQ,kBACNqB,SAAOL,GACVA,EAAUE,EAAOE,EAAUN,SAC3BQ,QAAMN,GACJA,EACAP,YACL,CAAES,EAAOF,EAAWI,EAAUN,WAStBS,eAAiB,SAACN,EAAOO,OAG/BA,EAAc,OAAOP,MAEpBC,EAAQC,aAERM,EAAgBzB,WACpB,kBAAOqB,SAAOG,GAAgBA,EAAaN,GAASM,IACpD,CAAEN,EAAOD,EAAOO,WAGXxB,WAAQ,uDAAYyB,GAAkBR,KAAU,CAAEQ,EAAeR,KC7GtES,EAAsBjB,UAWbkB,QAAU,SAACrC,OAAWsC,yDAAY,QAASC,yDAASpB,UACzDV,EAAWV,iBAAiBC,GAC5BwC,EAAeC,gBAAczC,qCACjCQ,UAAWC,GACR2B,OACHnC,YAAaQ,GACV8B,WAOE,SAACb,EAAWQ,OACXQ,EAAYC,UAAMC,YAAW,SAACjB,EAAOkB,OACnC9B,EAAWU,YAAYC,EAAWC,GAClChB,EAAWJ,iBAAiBoB,EAAMnB,UAAWC,GAC7CO,EAAiB8B,SAAOnB,EAAMW,IAAcX,EAAMW,GAAa,KAE/DS,EAASjC,oBAAoBC,EAAUC,GACvCgC,EAAcf,eAAeN,EAAOO,UAGxCS,wBAACH,gBACKQ,uBACGV,EAAYS,IACnBF,IAAKA,EACLrC,UAAWG,EACXsC,wBAAyBX,eAK/BI,EAAUzC,8BAAyBQ,OAE5BiC,IAaXL,QAAQa,UAAY,SAAAX,GACbP,QAAMO,IACTY,QAAQC,uDAAwDb,GAClEH,EAAsBG"}